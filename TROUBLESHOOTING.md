# トラブルシューティングガイド

## 🚨 よくあるエラーと解決方法

### 1. Firebase Functions のデプロイエラー

#### エラー: `Cannot set CPU on the functions api because they are GCF gen 1`
**原因**: Firebase Functions の1世代と2世代の設定が混在している

**解決方法**:
```javascript
// 修正前（1世代の書き方）
exports.api = functions
  .runWith({
    timeoutSeconds: 540,
    memory: '256MB'
  })
  .https.onRequest(app);

// 修正後（2世代の書き方）
const { onRequest } = require("firebase-functions/v2/https");
exports.api = onRequest({
  cors: true,
  maxInstances: 10,
}, app);
```

#### エラー: `Permission 'iam.serviceAccounts.signBlob' denied`
**原因**: Firebase Functions のサービスアカウントに権限が不足

**解決方法**:
1. [Google Cloud Console](https://console.cloud.google.com/iam-admin/iam) にアクセス
2. プロジェクトを選択
3. サービスアカウント一覧から `PROJECT_ID@appspot.gserviceaccount.com` を探す
4. 「編集」→「ロールを追加」
5. **「サービスアカウントトークン作成者」**を追加
6. 保存

### 2. フロントエンドの起動エラー

#### エラー: `npm start` でエラーが発生
**原因**: パッケージが正しくインストールされていない

**解決方法**:
```bash
# パッケージを再インストール
npm install

# キャッシュをクリアしてから再インストール
npm cache clean --force
npm install
```

#### エラー: `Module not found`
**原因**: ファイルパスやインポートが間違っている

**解決方法**:
1. ファイル名の大文字小文字を確認
2. インポートパスが正しいか確認
3. ファイルが存在するか確認

### 3. 認証関連のエラー

#### エラー: ユーザー登録が失敗する
**原因**: バックエンドのAPIが正しく動作していない

**解決方法**:
1. バックエンドがデプロイされているか確認
2. APIのURLが正しいか確認
3. ブラウザのコンソール（F12）でエラーメッセージを確認

#### エラー: ログインできない
**原因**: ユーザーが正しく作成されていない、またはパスワードが間違っている

**解決方法**:
1. 新規登録を試す
2. パスワードが6文字以上か確認
3. メールアドレスの形式が正しいか確認

### 4. カレンダー関連のエラー

#### エラー: 予約が表示されない
**原因**: 予約データが正しく取得できていない

**解決方法**:
1. ブラウザのコンソールでエラーメッセージを確認
2. ネットワークタブでAPIリクエストが成功しているか確認
3. バックエンドのログを確認

#### エラー: 予約フォームが開かない
**原因**: 時間枠のクリックイベントが正しく動作していない

**解決方法**:
1. ◎マークの時間枠をクリックしているか確認
2. ブラウザのコンソールでエラーメッセージを確認

## 🔧 デバッグ方法

### 1. ブラウザでのデバッグ
1. **F12キー**を押して開発者ツールを開く
2. **Console**タブでエラーメッセージを確認
3. **Network**タブでAPIリクエストの状況を確認

### 2. バックエンドのログ確認
```bash
# ログファイルを確認
cat functions/logs/app.log

# リアルタイムでログを監視
tail -f functions/logs/app.log
```

### 3. Firebase Consoleでの確認
1. [Firebase Console](https://console.firebase.google.com/) にアクセス
2. プロジェクトを選択
3. **Functions** → **ログ**でエラーログを確認
4. **Firestore Database** → **logs**コレクションでエラーログを確認

## 📋 チェックリスト

### 環境構築時の確認項目
- [ ] Node.js のバージョンが18以上
- [ ] Firebase CLI がインストールされている
- [ ] Firebase にログインしている
- [ ] 正しいプロジェクトを選択している
- [ ] 必要なパッケージがインストールされている

### アプリ起動時の確認項目
- [ ] バックエンドがデプロイされている
- [ ] フロントエンドが起動している
- [ ] ブラウザで `http://localhost:3000` にアクセスできる
- [ ] エラーメッセージが表示されていない

### 機能テスト時の確認項目
- [ ] ユーザー登録ができる
- [ ] ログインができる
- [ ] カレンダーが表示される
- [ ] 予約フォームが開く
- [ ] 予約が作成できる

## 🆘 それでも解決しない場合

### 1. エラーメッセージをコピー
- ブラウザのコンソールのエラーメッセージ
- ターミナルのエラーメッセージ
- Firebase Consoleのログ

### 2. 環境情報を確認
- OSの種類とバージョン
- Node.jsのバージョン
- ブラウザの種類とバージョン

### 3. 再現手順を記録
- どの操作でエラーが発生するか
- エラーが発生する前の操作
- 期待される動作

## 💡 予防策

### 1. 定期的なバックアップ
- 重要なファイルは定期的にバックアップ
- 設定変更前は必ずバックアップ

### 2. 段階的なテスト
- 小さな変更を少しずつテスト
- 一度に大きな変更をしない

### 3. ログの確認習慣
- エラーがなくても定期的にログを確認
- 異常を早期に発見する

## 📞 サポート情報

### 参考資料
- [Firebase公式ドキュメント](https://firebase.google.com/docs)
- [React公式ドキュメント](https://reactjs.org/docs)
- [Node.js公式ドキュメント](https://nodejs.org/docs)

### コミュニティ
- [Stack Overflow](https://stackoverflow.com/)
- [GitHub Issues](https://github.com/)

---

**このガイドで解決しない場合は、エラーメッセージと環境情報を添えて、詳しい方に相談してください。** 