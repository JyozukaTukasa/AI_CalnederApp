# 開発ノート

## 📅 開発履歴とトラブルシューティング

### Day 1: プロジェクト初期設定

#### 発生した問題
1. **Firebase Functions のデプロイエラー**
   - エラー: `Cannot set CPU on the functions api because they are GCF gen 1`
   - 原因: Firebase Functions 1世代と2世代の設定が混在

#### 解決方法
```javascript
// 1世代の書き方（古い）
exports.api = functions
  .runWith({
    timeoutSeconds: 540,
    memory: '256MB'
  })
  .https.onRequest(app);

// 2世代の書き方（新しい）
const { onRequest } = require("firebase-functions/v2/https");
exports.api = onRequest({
  cors: true,
  maxInstances: 10,
}, app);
```

#### 学んだこと
- Firebase Functions は2世代が推奨されている
- 1世代は非推奨で、CPU設定などの制限がある

---

### Day 2: 認証機能の実装

#### 発生した問題
1. **カスタムトークン作成エラー**
   - エラー: `Permission 'iam.serviceAccounts.signBlob' denied`
   - 原因: サービスアカウントに権限が不足

#### 解決方法
1. Google Cloud Console で IAM 設定を確認
2. サービスアカウントに「サービスアカウントトークン作成者」権限を追加
3. 一時的にカスタムトークン作成を無効化

#### 学んだこと
- Firebase Functions のサービスアカウントには適切な権限が必要
- カスタムトークンは認証に必須ではない

---

### Day 3: フロントエンドとバックエンドの連携

#### 発生した問題
1. **APIリクエストエラー**
   - エラー: `CORS error` や `Network error`
   - 原因: CORS設定やAPIエンドポイントの不整合

#### 解決方法
```javascript
// バックエンドでCORS設定
app.use(cors({
  origin: true,
  credentials: true
}));

// フロントエンドでAPI URL設定
export const API_BASE_URL = 'https://api-v7giyqljva-uc.a.run.app';
```

#### 学んだこと
- CORS設定はフロントエンドとバックエンドの連携に重要
- APIエンドポイントのURLは正確に設定する必要がある

---

### Day 4: カレンダー機能の実装

#### 発生した問題
1. **予約データの表示エラー**
   - エラー: カレンダーに予約が表示されない
   - 原因: データの取得・表示ロジックの不整合

#### 解決方法
1. バックエンドで予約データの取得APIを確認
2. フロントエンドでデータの受け渡しを修正
3. デバッグログを追加して問題を特定

#### 学んだこと
- データの流れを追跡するデバッグログが重要
- フロントエンドとバックエンドのデータ形式を統一する必要がある

---

### Day 5: エラーハンドリングとログ機能

#### 発生した問題
1. **エラーログの管理**
   - 問題: エラーが発生しても追跡できない
   - 原因: 統一されたエラーハンドリングがなかった

#### 解決方法
1. 共通エラーハンドラーミドルウェアを作成
2. ファイルとFirestoreの両方にログを保存
3. エラーメッセージの統一

#### 学んだこと
- エラーハンドリングは開発初期から設計する
- ログは問題の特定と解決に不可欠

---

## 🔧 技術的な学び

### 1. Firebase Functions の使い方
- **1世代 vs 2世代**: 2世代が推奨、設定が簡単
- **デプロイ**: `firebase deploy --only functions`
- **ログ確認**: Firebase Console の Functions ログ

### 2. React のベストプラクティス
- **状態管理**: useState と useEffect の適切な使用
- **コンポーネント分割**: 機能ごとにコンポーネントを分ける
- **エラーハンドリング**: try-catch とエラー状態の管理

### 3. API設計のポイント
- **RESTful**: 適切なHTTPメソッドとエンドポイント
- **エラーレスポンス**: 統一されたエラー形式
- **バリデーション**: フロントエンドとバックエンドの両方で実装

---

## 📋 今後の改善点

### 1. セキュリティ強化
- [ ] パスワードの強度チェック
- [ ] レート制限の実装
- [ ] 入力値のサニタイゼーション

### 2. パフォーマンス改善
- [ ] データベースのインデックス最適化
- [ ] フロントエンドの遅延読み込み
- [ ] キャッシュ機能の実装

### 3. ユーザビリティ向上
- [ ] レスポンシブデザインの改善
- [ ] アクセシビリティの向上
- [ ] 多言語対応

---

## 💡 開発のコツ

### 1. 段階的な開発
- 小さな機能から実装
- 各段階でテスト
- 問題を早期に発見

### 2. デバッグの重要性
- ログを積極的に活用
- エラーメッセージを詳しく確認
- ブラウザの開発者ツールを活用

### 3. ドキュメント化
- コードにコメントを書く
- 設定や手順を記録
- トラブルシューティングをまとめる

---

## 🎯 成功要因

### 1. 適切な技術選択
- Firebase Functions 2世代の採用
- React Hooks の活用
- Express.js の使用

### 2. 段階的な実装
- 認証 → カレンダー → 予約 の順序
- 各段階でのテスト
- 問題の早期解決

### 3. エラーハンドリング
- 統一されたエラー処理
- ログ機能の実装
- デバッグ情報の充実

---

**この開発ノートは、今後のプロジェクトで参考にしてください。** 